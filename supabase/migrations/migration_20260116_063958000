-- 创建会话表
create table if not exists conversations (
  id uuid primary key default gen_random_uuid(),
  created_at timestamp with time zone default now()
);

-- 创建消息表
create table if not exists messages (
  id uuid primary key default gen_random_uuid(),
  conversation_id uuid references conversations(id) on delete cascade,
  role text not null check (role in ('user', 'assistant')),
  content text not null,
  model text check (model in ('doubao', 'deepseek', 'wenxin')),
  created_at timestamp with time zone default now()
);

-- 创建索引
create index if not exists messages_conversation_id_idx on messages(conversation_id);
create index if not exists messages_created_at_idx on messages(created_at);

-- 启用RLS
alter table conversations enable row level security;
alter table messages enable row level security;

-- 创建策略（允许所有操作，因为这是演示应用）
create policy "Allow all operations on conversations"
  on conversations for all
  using (true)
  with check (true);

create policy "Allow all operations on messages"
  on messages for all
  using (true)
  with check (true);